<div id="my-container" class="container-fluid">
  <div class="row">
    <div class="col-xs-12 col-md-offset-2 col-md-8 col-lg-offset-3 col-lg-6">
      <br/>
      <br/>
      <% if @references.any? %>
          <div class="panel panel-default">
            <div class="panel-body">
              <h3>
                <span class="icon-4 pull-right" style="margin-right: 15px"></span>
                Ces références
                <% if logged_in? %>
                    <% if params[:filter] == "mine" %>
                        que vous avez ajoutées
                    <% else %>
                        qui vous intéressent
                    <% end %>
                <% end %>
                    n'ont pas encore d'analyse, soyez le premier à les décortiquer !
              </h3>
            </div>
          </div>
          <div id="cd-timeline" class="cd-container">
            <% @references.each do |reference| %>
                <div class="cd-timeline-block binary3">
                  <div class="cd-timeline-img gradient-orange">
                  </div>
                  <div class="cd-timeline-content">
                    <h2> <%= link_to reference.title, new_comment_path(reference_id: reference.id ), class: "hvr-grow1 orange" %>
                    </h2>
                    <h2>
                    dans la controverse
                    </h2>
                    <h2> <%= link_to reference.timeline_name.html_safe, timeline_path( reference.timeline_id ), class: "hvr-grow1" %>
                    </h2>
                    <span class="cd-date">Référence ajoutée il y a <%= time_ago_in_words(reference.created_at) %></span>
                  </div>
                </div>
            <% end %>
          </div>
      <% else %>
          <div class="panel panel-default">
            <div class="panel-body">
              <h3>
                <span class="icon-4 pull-right" style="margin-right: 15px"></span>
                Toutes les références
                <% if logged_in? %>
                    <% if params[:filter] == "mine" %>
                        que vous avez ajoutées
                    <% else %>
                        qui vous intéressent
                    <% end %>
                <% end %>
                ont actuellement au moins une analyse.
              </h3>
              <%= link_to "<span class=\"icon-frog fat\"></span> Voir les controverses".html_safe, timelines_path, class: "btn btn-primary btn-lg pull-right" %>
            </div>
          </div>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip({container: 'body'});
        var $timeline_block = $('.cd-timeline-block');

        //hide timeline blocks which are outside the viewport
        $timeline_block.each(function(){
            $(this).find('.cd-timeline-img, .cd-timeline-content').addClass('is-hidden');
        });

        $timeline_block.each(function(){
            if( $(this).offset().top <= $(window).scrollTop()+$(window).height()*0.95 ) {
                $(this).find('.cd-timeline-img, .cd-timeline-content').removeClass('is-hidden').addClass('bounce-in');
            }
        });

        //on scolling, show/animate timeline blocks when enter the viewport
        $(window).on('scroll', function(){
            $timeline_block.each(function(){
                if( $(this).offset().top <= $(window).scrollTop()+$(window).height()*0.95 && $(this).find('.cd-timeline-img').hasClass('is-hidden') ) {
                    $(this).find('.cd-timeline-img, .cd-timeline-content').removeClass('is-hidden').addClass('bounce-in');
                }
            });
        });
    });
</script>
