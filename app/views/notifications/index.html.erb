<% provide(:title, "Notifications") %>

<%= form_for( :notification, url: notifications_delete_path, method: :post ) do |f| %>
<div class="row">

<div class="col-md-2">
  <strong>
  Les nouvelles :
  </strong>
    <div>
      <% { timeline: "Controverses",
           summary: "Synthèses",
           reference: "Références",
           comment: "Analyses"}.each do |key, value| %>
          <%= link_to image_tag("icons/myicon-#{key}.svg", alt: value,
                                height: "28px")+"&nbsp".html_safe+value+
                              " ("+current_user.send( "notifications_#{key}".to_sym).to_s+")",
                      notifications_index_path(filter: key), class: "btn btn-primary btn-block" %>
      <% end %>
    </div>
  <br/>
  <strong>
  Ont pris la première place :
  </strong>
  <div>
    <% { summary_selection: "Synthèses",
         selection: "Analyses"
         }.each do |key, value| %>
        <%= link_to image_tag("icons/myicon-#{key}.svg", alt: value,
                              height: "28px")+"&nbsp".html_safe+value+
                            " ("+current_user.send( "notifications_#{key}".to_sym).to_s+")",
                    notifications_index_path(filter: key), class: "btn btn-primary btn-block" %>
    <% end %>
  </div>
</div>

<div class="col-md-8">
<div class="panel panel-default">
  <% if @filter == :timeline %>
  <div class="panel-heading">
    Les nouvelles controverses (<%= current_user.notifications_timeline %>)
  </div>
    <table id="notification-timelines" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-sm-2"> <input title="toggle all" type="checkbox" id="checktimelines"> </th>
        <th class="col-sm-7"> La controverse  </th>
        <th class="col-sm-3"> Thèmes </th>
      </tr>
      </thead>
      <tbody class="page">
      <% if !@timelines.any? %>
          <tr class="notification-timeline">
            <td></td>
            <td> Pas de nouvelles notifications </td>
            <td></td>
          </tr>
      <% else %>
          <% @timelines.each do |timeline| %>
              <tr class="following-timeline">
                <td> <%= f.check_box :timeline_ids, { :multiple => true},
                             checked_value = timeline.id, unchecked_value = nil %> </td>
                <td> <%= link_to timeline.name, notifications_timeline_url( id: timeline.id) %> </td>
                <td>
                  <% timeline.get_tag_list.each do |name| %>
                      <%= image_tag("icons/myicon-#{name}.svg", alt: name,
                                    title: tags_hash[name],  height: "24px")%>
                  <% end %>
                </td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
    <%= paginate @timelines %>
        
    <% elsif @filter == :summary %>
    <div class="panel-heading">
      Les nouvelles synthèses (<%= current_user.notifications_summary %>)
    </div>
    <table id="notification-summaries" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-sm-1"> <input title="toggle all" type="checkbox" id="checksummaries"> </th>
        <th class="col-sm-4"> La synthèse  </th>
        <th class="col-sm-3"> De la controverse </th>
      </tr>
      </thead>
      <tbody class="page">
      <% if !@summaries.any? %>
          <tr class="notification-summary">
            <td></td>
            <td> Pas de notifications </td>
            <td></td>
          </tr>
      <% else %>
          <% @summaries.each do |com| %>
              <tr class="notification-summary">
                <td> <%= f.check_box :summary_ids, { :multiple => true},
                                     checked_value = com.id, unchecked_value = nil %> </td>
                <td> <%= link_to com.content[0..70]+"...", notifications_summary_path(id: com.id ) %>   </td>
                <td> <%= link_to com.timeline_name, timeline_path(com.timeline_id ) %>   </td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
    <%= paginate @summaries %>
        
    <% elsif @filter == :reference %>
    <div class="panel-heading">
      Les nouvelles références (<%= current_user.notifications_reference %>)
    </div>
    <table id="notification-references" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-sm-2"> <input title="toggle all" type="checkbox" id="checkreferences"> </th>
        <th class="col-sm-6"> La référence  </th>
        <th class="col-sm-4"> Dans la controverse </th>
      </tr>
      </thead>
      <tbody class="page">
      <% if !@references.any? %>
          <tr class="notification-reference">
            <td></td>
            <td></td>
            <td> Pas de notifications </td>
          </tr>
      <% else %>
          <% @references.each do |reference| %>
              <tr class="notification-reference">
                <td> <%= f.check_box :reference_ids, { :multiple => true},
                                     checked_value = reference.id, unchecked_value = nil %> </td>
                <td> <%= link_to reference.title_fr.html_safe,
                            notifications_reference_path( id: reference.id ) %>   </td>
                <td> <%= link_to reference.timeline_name, timeline_path( reference.timeline_id ) %>   </td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
  <%= paginate @references %>
        
  <% elsif @filter == :comment %>
    <div class="panel-heading">
      Les nouvelles analyses (<%= current_user.notifications_comment %>)
    </div>
    <table id="notification-comments" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-sm-1"> <input title="toggle all" type="checkbox" id="checkcomments"> </th>
        <th class="col-sm-4"> L'analyse  </th>
        <th class="col-sm-4"> De la référence </th>
        <th class="col-sm-3"> Dans la controverse </th>
      </tr>
      </thead>
      <tbody class="page">
      <% if !@comments.any? %>
          <tr class="notification-comment">
            <td></td>
            <td> Pas de notifications </td>
            <td></td>
            <td></td>
          </tr>
      <% else %>
          <% @comments.each do |com| %>
              <tr class="notification-comment">
                <td> <%= f.check_box :comment_ids, { :multiple => true},
                                     checked_value = com.id, unchecked_value = nil %> </td>
                <td> <%= link_to com.f_1_content[0..70]+"...", notifications_comment_path(id: com.id ) %>   </td>
                <td> <%= link_to com.reference_title, reference_path(com.reference_id) %>   </td>
                <td> <%= link_to com.timeline_name, timeline_path(com.timeline_id ) %>   </td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
  <%= paginate @comments %>
        
  <% elsif @filter == :selection %>
    <div class="panel-heading">
      Les analyses qui ont pris la première place
      (<%= current_user.notifications_selection %>)
    </div>
  <table id="notification-sel-comments" class="table table-striped table-hover">
    <thead>
    <tr>
      <th class="col-sm-1"> <input title="toggle all" type="checkbox" id="checkselcomments"> </th>
      <th class="col-sm-4"> L'analyse </th>
      <th class="col-sm-4"> De la référence </th>
      <th class="col-sm-3"> Dans la controverse </th>
    </tr>
    </thead>
    <tbody class="page">
    <% if !@selections.any? %>
        <tr class="notification-sel-comment">
          <td></td>
          <td> Pas de notifications</td>
          <td></td>
          <td> </td>
        </tr>
    <% else %>
        <% @selections.each do |com| %>
            <tr class="notification-sel-comment">
              <td> <%= f.check_box :sel_comment_ids, { :multiple => true},
                                   checked_value = com.id, unchecked_value = nil %> </td>
              <td> <%= link_to com.f_1_content[0..70]+"...", notifications_selection_path(id: com.id ) %>   </td>
              <td> <%= link_to com.reference_title, reference_path(com.reference_id) %>   </td>
              <td> <%= link_to com.timeline_name, timeline_path(com.timeline_id ) %>   </td>
            </tr>
        <% end %>
    <% end %>
    </tbody>
  </table>
  <%= paginate @selections %>

  <% elsif @filter == :summary_selection %>
    <div class="panel-heading">
      Les synthèses qui ont pris la première place
      (<%= current_user.notifications_summary_selection %>)
    </div>
    <table id="notification-sel-summaries" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-sm-1"> <input title="toggle all" type="checkbox" id="checkselsummaries"> </th>
        <th class="col-sm-4"> Synthèse </th>
        <th class="col-sm-4"> De la controverse </th>
      </tr>
      </thead>
      <tbody class="page">
      <% if !@summary_selections.any? %>
          <tr class="notification-sel-summary">
            <td></td>
            <td> Pas de notifications   </td>
            <td></td>
          </tr>
      <% else %>
          <% @summary_selections.each do |com| %>
              <tr class="notification-sel-summary">
                <td> <%= f.check_box :sel_summary_ids, { :multiple => true},
                                     checked_value = com.id, unchecked_value = nil %> </td>
                <td> <%= link_to com.content[0..70]+"...", notifications_summary_selection_path(id: com.id ) %>   </td>
                <td> <%= link_to com.timeline_name, timeline_path(com.timeline_id ) %>   </td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
    <%= paginate @summary_selections %>
        
  <% end %>
</div>
</div>

<div class="col-md-2">
    <%= f.submit "Supprimer les notifications sélectionnées", class: "btn btn-danger btn-block"%>
 </br>
  <%= link_to image_tag("icons/myicon-#{@filter}.svg",height: "28px")+
                      "&nbsp".html_safe+"Supprimer toutes les notifications",
              notifications_delete_all_path(filter: @filter), class: "btn btn-danger btn-block" %>
</div>

</div>

<% end %>

<script type="text/javascript">
$(document).ready(function() {
    $('#checktimelines').click(function () {
        if ($('#checktimelines').is(':checked')) {
            $('#notification-timelines input[type=checkbox]').each(function () {
                $(this).prop("checked", true);
            });

        } else {
            $("#notification-timelines input[type=checkbox]").each(function () {
                $(this).prop("checked", false);
            });
        }
    });
    $('#checksummaries').click(function () {
        if ($('#checksummaries').is(':checked')) {
            $('#notification-summaries input[type=checkbox]').each(function () {
                $(this).prop("checked", true);
            });

        } else {
            $("#notification-summaries input[type=checkbox]").each(function () {
                $(this).prop("checked", false);
            });
        }
    });
    $('#checkreferences').click(function () {
        if ($('#checkreferences').is(':checked')) {
            $('#notification-references input[type=checkbox]').each(function () {
                $(this).prop("checked", true);
            });

        } else {
            $("#notification-references input[type=checkbox]").each(function () {
                $(this).prop("checked", false);
            });
        }
    });
    $('#checkcomments').click(function () {
        if ($('#checkcomments').is(':checked')) {
            $('#notification-comments input[type=checkbox]').each(function () {
                $(this).prop("checked", true);
            });

        } else {
            $("#notification-comments input[type=checkbox]").each(function () {
                $(this).prop("checked", false);
            });
        }
    });
    $('#checkselcomments').click(function () {
        if ($('#checkselcomments').is(':checked')) {
            $('#notification-sel-comments input[type=checkbox]').each(function () {
                $(this).prop("checked", true);
            });

        } else {
            $("#notification-sel-comments input[type=checkbox]").each(function () {
                $(this).prop("checked", false);
            });
        }
    });
    $('#checkselsummaries').click(function () {
        if ($('#checkselsummaries').is(':checked')) {
            $('#notification-sel-summaries input[type=checkbox]').each(function () {
                $(this).prop("checked", true);
            });

        } else {
            $("#notification-sel-summaries input[type=checkbox]").each(function () {
                $(this).prop("checked", false);
            });
        }
    });
})
</script>